import * as assert from 'node:assert';
import { Ichimoku, IchimokuInput } from 'src/overlap/Ichimoku';

import { SampleBars } from '@/samples';

const input: IchimokuInput = {
  low: SampleBars.low,
  high: SampleBars.high,
  close: SampleBars.close,
  conversionPeriod: 9,
  basePeriod: 26,
  spanPeriod: 52,
};

const expectedResult = [
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 132.0125, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 132.0125, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 138.95, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 153.4000025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 170.4625, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 191.7874975, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 191.7874975, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 191.7874975, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 209.987495, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 215.7625025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 227.8125, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 235.8125, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 248.4000025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: NaN, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: 217.0125, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: 217.0125, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: 217.0125, spanA: NaN, spanB: NaN },
  { conversion: 257.9250025, base: 225.4375, spanA: NaN, spanB: NaN },
  { conversion: 253.6875, base: 226.7874975, spanA: NaN, spanB: NaN },
  { conversion: 250.0, base: 226.7874975, spanA: NaN, spanB: NaN },
  { conversion: 250.1999975, base: 226.7874975, spanA: NaN, spanB: NaN },
  { conversion: 262.3249975, base: 226.7874975, spanA: NaN, spanB: NaN },
  { conversion: 267.35, base: 226.7874975, spanA: NaN, spanB: NaN },
  { conversion: 286.7750025, base: 233.0374975, spanA: NaN, spanB: NaN },
  { conversion: 296.00000750000004, base: 250.787505, spanA: NaN, spanB: NaN },
  { conversion: 317.7750025, base: 280.5625, spanA: NaN, spanB: NaN },
  { conversion: 332.5, base: 295.9000025, spanA: NaN, spanB: NaN },
  { conversion: 338.0, base: 305.4250025, spanA: NaN, spanB: NaN },
  { conversion: 344.462495, base: 311.8874975, spanA: NaN, spanB: NaN },
  { conversion: 353.212495, base: 320.6374975, spanA: NaN, spanB: NaN },
  { conversion: 362.899995, base: 329.4250025, spanA: NaN, spanB: NaN },
  { conversion: 366.1374975, base: 329.4250025, spanA: NaN, spanB: NaN },
  { conversion: 379.024995, base: 329.4250025, spanA: NaN, spanB: NaN },
  { conversion: 407.524995, base: 357.9250025, spanA: NaN, spanB: NaN },
  { conversion: 441.124995, base: 391.5250025, spanA: NaN, spanB: NaN },
  { conversion: 441.124995, base: 391.5250025, spanA: NaN, spanB: NaN },
  { conversion: 441.124995, base: 396.1, spanA: NaN, spanB: NaN },
  { conversion: 441.124995, base: 396.1, spanA: NaN, spanB: NaN },
  { conversion: 444.224995, base: 411.325, spanA: NaN, spanB: NaN },
  { conversion: 480.875, base: 427.1500025, spanA: NaN, spanB: NaN },
  { conversion: 504.512495, base: 447.0125025, spanA: NaN, spanB: NaN },
  { conversion: 529.2375, base: 447.0125025, spanA: NaN, spanB: NaN },
  { conversion: 558.75, base: 475.0250025, spanA: NaN, spanB: NaN },
  { conversion: 562.85, base: 483.6, spanA: NaN, spanB: NaN },
  { conversion: 596.475, base: 489.1, spanA: NaN, spanB: NaN },
  { conversion: 644.65, base: 534.65, spanA: NaN, spanB: NaN },
  { conversion: 717.7249999999999, base: 577.45, spanA: NaN, spanB: NaN },
  { conversion: 734.625, base: 578.899995, spanA: NaN, spanB: NaN },
  { conversion: 781.2125, base: 619.2624975, spanA: NaN, spanB: NaN },
  { conversion: 785.5374999999999, base: 636.474995, spanA: NaN, spanB: NaN },
  { conversion: 915.8, base: 748.774995, spanA: NaN, spanB: NaN },
  { conversion: 1025.6625, base: 858.637495, spanA: NaN, spanB: NaN },
  { conversion: 1044.05, base: 877.024995, spanA: NaN, spanB: NaN },
  { conversion: 1073.3125, base: 892.024995, spanA: NaN, spanB: NaN },
  { conversion: 1207.3125, base: 969.524995, spanA: NaN, spanB: NaN },
  { conversion: 1236.275, base: 969.524995, spanA: NaN, spanB: NaN },
  { conversion: 1243.525, base: 995.375, spanA: NaN, spanB: NaN },
  { conversion: 1245.3, base: 1000.024995, spanA: NaN, spanB: NaN },
  { conversion: 1304.8125, base: 1024.75, spanA: NaN, spanB: NaN },
  { conversion: 1313.5625, base: 1026.25, spanA: NaN, spanB: NaN },
  { conversion: 1304.5, base: 1026.25, spanA: NaN, spanB: NaN },
  { conversion: 1304.5, base: 1059.875, spanA: NaN, spanB: NaN },
  { conversion: 1265.75, base: 1062.5, spanA: NaN, spanB: NaN },
  { conversion: 912.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 912.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 912.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 909.75, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 843.5, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 826.5, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 826.5, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 866.25, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 866.25, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 890.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 890.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 900.0, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 912.575, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 912.575, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 1008.0875, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 1063.025, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 1024.025, base: 1057.0, spanA: NaN, spanB: NaN },
  { conversion: 1004.225, base: 912.0, spanA: NaN, spanB: NaN },
  { conversion: 1025.5125, base: 912.0, spanA: NaN, spanB: NaN },
  { conversion: 1025.5125, base: 912.0, spanA: NaN, spanB: NaN },
  { conversion: 1025.5125, base: 909.75, spanA: NaN, spanB: NaN },
  { conversion: 1025.5125, base: 866.25, spanA: NaN, spanB: NaN },
  { conversion: 1032.45, base: 866.25, spanA: NaN, spanB: NaN },
  { conversion: 1032.45, base: 866.25, spanA: NaN, spanB: NaN },
  { conversion: 1032.35, base: 866.25, spanA: NaN, spanB: NaN },
  { conversion: 1032.35, base: 866.25, spanA: NaN, spanB: NaN },
  { conversion: NaN, base: NaN, spanA: 984.5, spanB: 924.5 },
  { conversion: NaN, base: NaN, spanA: 984.5, spanB: 936.625 },
  { conversion: NaN, base: NaN, spanA: 984.5, spanB: 941.6500025 },
  { conversion: NaN, base: NaN, spanA: 983.375, spanB: 942.5250025 },
  { conversion: NaN, base: NaN, spanA: 950.25, spanB: 942.5250025 },
  { conversion: NaN, base: NaN, spanA: 941.75, spanB: 942.5250025 },
  { conversion: NaN, base: NaN, spanA: 941.75, spanB: 947.0 },
  { conversion: NaN, base: NaN, spanA: 961.625, spanB: 952.5 },
  { conversion: NaN, base: NaN, spanA: 961.625, spanB: 952.5 },
  { conversion: NaN, base: NaN, spanA: 973.5, spanB: 952.5 },
  { conversion: NaN, base: NaN, spanA: 973.5, spanB: 953.399995 },
  { conversion: NaN, base: NaN, spanA: 978.5, spanB: 956.6374975 },
  { conversion: NaN, base: NaN, spanA: 984.7875, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 984.7875, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 1032.54375, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 1060.0125, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 1040.5125, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 958.1125, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 968.75625, spanB: 969.524995 },
  { conversion: NaN, base: NaN, spanA: 968.75625, spanB: 995.375 },
  { conversion: NaN, base: NaN, spanA: 967.63125, spanB: 1000.024995 },
  { conversion: NaN, base: NaN, spanA: 945.88125, spanB: 1024.75 },
  { conversion: NaN, base: NaN, spanA: 949.35, spanB: 1026.25 },
  { conversion: NaN, base: NaN, spanA: 949.35, spanB: 1026.25 },
  { conversion: NaN, base: NaN, spanA: 949.3, spanB: 1057.0 },
  { conversion: NaN, base: NaN, spanA: 949.3, spanB: 1057.0 },
];

describe('Ichimoku', () => {
  it('should match the expected result', () => {
    const result = new Ichimoku(input).getResult();
    assert.deepEqual(result, expectedResult);
  });
});
