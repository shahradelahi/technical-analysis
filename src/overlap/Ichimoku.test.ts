import * as assert from 'node:assert';
import { Ichimoku, IchimokuInput } from 'src/overlap/Ichimoku';

import { SampleBars } from '@/samples';

const input: IchimokuInput = {
  low: SampleBars.low,
  high: SampleBars.high,
  close: SampleBars.close,
  conversionPeriod: 9,
  basePeriod: 26,
  spanPeriod: 52,
};

const expectedResult = [
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: undefined, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 132.0125, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 132.0125, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 138.95, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 153.4000025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 170.4625, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 191.7874975, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 191.7874975, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 191.7874975, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 209.987495, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 215.7625025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 227.8125, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 235.8125, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 248.4000025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: undefined, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: 217.0125, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: 217.0125, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: 217.0125, spanA: undefined, spanB: undefined },
  { conversion: 257.9250025, base: 225.4375, spanA: undefined, spanB: undefined },
  { conversion: 253.6875, base: 226.7874975, spanA: undefined, spanB: undefined },
  { conversion: 250, base: 226.7874975, spanA: undefined, spanB: undefined },
  { conversion: 250.1999975, base: 226.7874975, spanA: undefined, spanB: undefined },
  { conversion: 262.3249975, base: 226.7874975, spanA: undefined, spanB: undefined },
  { conversion: 267.35, base: 226.7874975, spanA: undefined, spanB: undefined },
  { conversion: 286.7750025, base: 233.0374975, spanA: undefined, spanB: undefined },
  { conversion: 296.00000750000004, base: 250.787505, spanA: undefined, spanB: undefined },
  { conversion: 317.7750025, base: 280.5625, spanA: undefined, spanB: undefined },
  { conversion: 332.5, base: 295.9000025, spanA: undefined, spanB: undefined },
  { conversion: 338, base: 305.4250025, spanA: undefined, spanB: undefined },
  { conversion: 344.462495, base: 311.8874975, spanA: undefined, spanB: undefined },
  { conversion: 353.212495, base: 320.6374975, spanA: undefined, spanB: undefined },
  { conversion: 362.899995, base: 329.4250025, spanA: undefined, spanB: undefined },
  { conversion: 366.1374975, base: 329.4250025, spanA: undefined, spanB: undefined },
  { conversion: 379.024995, base: 329.4250025, spanA: undefined, spanB: undefined },
  { conversion: 407.524995, base: 357.9250025, spanA: undefined, spanB: undefined },
  { conversion: 441.124995, base: 391.5250025, spanA: undefined, spanB: undefined },
  { conversion: 441.124995, base: 391.5250025, spanA: undefined, spanB: undefined },
  { conversion: 441.124995, base: 396.1, spanA: undefined, spanB: undefined },
  { conversion: 441.124995, base: 396.1, spanA: undefined, spanB: undefined },
  { conversion: 444.224995, base: 411.325, spanA: undefined, spanB: undefined },
  { conversion: 480.875, base: 427.1500025, spanA: 237.46875125, spanB: undefined },
  { conversion: 504.512495, base: 447.0125025, spanA: 237.46875125, spanB: undefined },
  { conversion: 529.2375, base: 447.0125025, spanA: 237.46875125, spanB: undefined },
  { conversion: 558.75, base: 475.0250025, spanA: 241.68125125, spanB: undefined },
  { conversion: 562.85, base: 483.6, spanA: 240.23749875, spanB: undefined },
  { conversion: 596.475, base: 489.1, spanA: 238.39374875, spanB: undefined },
  { conversion: 644.65, base: 534.65, spanA: 238.49374749999998, spanB: undefined },
  { conversion: 717.7249999999999, base: 577.45, spanA: 244.55624749999998, spanB: undefined },
  { conversion: 734.625, base: 578.899995, spanA: 247.06874875, spanB: undefined },
  { conversion: 781.2125, base: 619.2624975, spanA: 259.90625, spanB: undefined },
  { conversion: 785.5374999999999, base: 636.474995, spanA: 273.39375625, spanB: undefined },
  { conversion: 915.8, base: 748.774995, spanA: 299.16875125, spanB: undefined },
  { conversion: 1025.6625, base: 858.637495, spanA: 314.20000125, spanB: undefined },
  { conversion: 1044.05, base: 877.024995, spanA: 321.71250125, spanB: undefined },
  { conversion: 1073.3125, base: 892.024995, spanA: 328.17499625, spanB: undefined },
  { conversion: 1207.3125, base: 969.524995, spanA: 336.92499625, spanB: undefined },
  { conversion: 1236.275, base: 969.524995, spanA: 346.16249875, spanB: undefined },
  { conversion: 1243.525, base: 995.375, spanA: 347.78125, spanB: undefined },
  { conversion: 1245.3, base: 1000.024995, spanA: 354.22499875, spanB: undefined },
  { conversion: 1304.8125, base: 1024.75, spanA: 382.72499875, spanB: undefined },
  { conversion: 1313.5625, base: 1026.25, spanA: 416.32499875, spanB: undefined },
  { conversion: 1304.5, base: 1026.25, spanA: 416.32499875, spanB: undefined },
  { conversion: 1304.5, base: 1059.875, spanA: 418.6124975, spanB: undefined },
  { conversion: 1265.75, base: 1062.5, spanA: 418.6124975, spanB: undefined },
  { conversion: 912, base: 1057, spanA: 427.7749975, spanB: undefined },
  { conversion: 912, base: 1057, spanA: 454.01250125, spanB: undefined },
  { conversion: 912, base: 1057, spanA: 475.76249874999996, spanB: 383.5 },
  { conversion: 909.75, base: 1057, spanA: 488.12500124999997, spanB: 383.5 },
  { conversion: 843.5, base: 1057, spanA: 516.88750125, spanB: 411.5125 },
  { conversion: 826.5, base: 1057, spanA: 523.225, spanB: 424.0375 },
  { conversion: 826.5, base: 1057, spanA: 542.7875, spanB: 425.3874975 },
  { conversion: 866.25, base: 1057, spanA: 589.65, spanB: 470.93749749999995 },
  { conversion: 866.25, base: 1057, spanA: 647.5875, spanB: 513.7374975 },
  { conversion: 890, base: 1057, spanA: 656.7624975, spanB: 514.2874975 },
  { conversion: 890, base: 1057, spanA: 700.23749875, spanB: 551.4124975 },
  { conversion: 900, base: 1057, spanA: 711.0062475, spanB: 555.7374975 },
  { conversion: 912.575, base: 1057, spanA: 832.2874975, spanB: 676.5625 },
  { conversion: 912.575, base: 1057, spanA: 942.1499974999999, spanB: 794.425 },
  { conversion: 1008.0875, base: 1057, spanA: 960.5374975, spanB: 817.9000025 },
  { conversion: 1063.025, base: 1057, spanA: 982.6687475, spanB: 842.4250025 },
  { conversion: 1024.025, base: 1057, spanA: 1088.4187474999999, spanB: 919.9250025 },
  { conversion: 1004.225, base: 912, spanA: 1102.8999975000002, spanB: 919.9250025 },
  { conversion: 1025.5125, base: 912, spanA: 1119.45, spanB: 919.9250025 },
  { conversion: 1025.5125, base: 912, spanA: 1122.6624975, spanB: 919.9250025 },
  { conversion: 1025.5125, base: 909.75, spanA: 1164.78125, spanB: 919.9250025 },
  { conversion: 1025.5125, base: 866.25, spanA: 1169.90625, spanB: 919.9250025 },
  { conversion: 1032.45, base: 866.25, spanA: 1165.375, spanB: 919.9250025 },
  { conversion: 1032.45, base: 866.25, spanA: 1182.1875, spanB: 919.9250025 },
  { conversion: 1032.35, base: 866.25, spanA: 1164.125, spanB: 924.5 },
  { conversion: 1032.35, base: 866.25, spanA: 984.5, spanB: 924.5 },
  { conversion: undefined, base: undefined, spanA: 984.5, spanB: 936.625 },
  { conversion: undefined, base: undefined, spanA: 984.5, spanB: 941.6500025 },
  { conversion: undefined, base: undefined, spanA: 983.375, spanB: 942.5250025 },
  { conversion: undefined, base: undefined, spanA: 950.25, spanB: 942.5250025 },
  { conversion: undefined, base: undefined, spanA: 941.75, spanB: 942.5250025 },
  { conversion: undefined, base: undefined, spanA: 941.75, spanB: 947 },
  { conversion: undefined, base: undefined, spanA: 961.625, spanB: 952.5 },
  { conversion: undefined, base: undefined, spanA: 961.625, spanB: 952.5 },
  { conversion: undefined, base: undefined, spanA: 973.5, spanB: 952.5 },
  { conversion: undefined, base: undefined, spanA: 973.5, spanB: 953.399995 },
  { conversion: undefined, base: undefined, spanA: 978.5, spanB: 956.6374975 },
  { conversion: undefined, base: undefined, spanA: 984.7875, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 984.7875, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 1032.54375, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 1060.0125, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 1040.5125, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 958.1125, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 968.75625, spanB: 969.524995 },
  { conversion: undefined, base: undefined, spanA: 968.75625, spanB: 995.375 },
  { conversion: undefined, base: undefined, spanA: 967.63125, spanB: 1000.024995 },
  { conversion: undefined, base: undefined, spanA: 945.88125, spanB: 1024.75 },
  { conversion: undefined, base: undefined, spanA: 949.35, spanB: 1026.25 },
  { conversion: undefined, base: undefined, spanA: 949.35, spanB: 1026.25 },
  { conversion: undefined, base: undefined, spanA: 949.3, spanB: 1057 },
  { conversion: undefined, base: undefined, spanA: 949.3, spanB: 1057 },
];

describe('Ichimoku', () => {
  it('should match the expected result', () => {
    const result = Ichimoku.calculate(input);
    assert.deepEqual(result, expectedResult);
  });
});
